{% extends "users/base.html" %}
{% block title %}Редактировать профиль - {{ user.username }}{% endblock %}


{% block content %}
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-7">
                <div class="card shadow-sm border-0 rounded-4">
                    <div class="card-header bg-primary text-white text-center py-3">
                        <h4 class="mb-0"><i class="fas fa-user-edit me-2"></i> Редактировать профиль</h4>
                    </div>
                    <div class="card-body p-4">
                        <form action="/profile/edit/{{ user.id }}" method="post" novalidate>
                            <div class="mb-3">
                                <label for="first_name" class="form-label">Имя</label>
                                <input type="text" id="first_name" name="first_name"
                                       value="{{ profile_data.get('first_name', '') }}"
                                       class="form-control rounded-pill shadow-sm">
                            </div>

                            <!-- Фамилия -->
                            <div class="mb-3">
                                <label for="last_name" class="form-label">Фамилия</label>
                                <input type="text" id="last_name" name="last_name"
                                       value="{{ profile_data.get('last_name', '') }}"
                                       class="form-control rounded-pill shadow-sm">
                            </div>

                            <div class="mb-3">
                                <label for="middle_name" class="form-label">Отчество</label>
                                <input type="text" id="middle_name" name="middle_name"
                                       value="{{ profile_data.get('middle_name', '') }}"
                                       class="form-control rounded-pill shadow-sm">
                            </div>

                            <div class="mb-3">
                                <label for="birth_date" class="form-label">Дата рождения</label>
                                <input type="date" id="birth_date" name="birth_date"
                                       value="{{ profile_data.get('birth_date', '') }}"
                                       class="form-control rounded-pill shadow-sm">
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Пол</label><br>
                                <div class="d-flex gap-3">
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="gender"
                                               id="gender-male" value="Мужской"
                                                {% if profile_data.get('gender') == 'Мужской' %} checked {% endif %}>
                                        <label class="form-check-label" for="gender-male">Мужской</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="gender"
                                               id="gender-female" value="Женский"
                                                {% if profile_data.get('gender') == 'Женский' %} checked {% endif %}>
                                        <label class="form-check-label" for="gender-female">Женский</label>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="phone_number" class="form-label">Телефон</label>
                                <input type="tel" id="phone_number" name="phone_number"
                                       value="{{ profile_data.get('phone_number', '') }}"
                                       class="form-control rounded-pill shadow-sm"
                                       placeholder="+7 (999) 999-99-99"
                                       pattern="\+7$[0-9]{3}$ [0-9]{3}-[0-9]{2}-[0-9]{2}"
                                       required>
                            </div>

                            <div class="mb-3">
                                <label for="country" class="form-label">Страна</label>
                                <input type="text" id="country" name="country"
                                       value="{{ profile_data.get('country', '') }}"
                                       class="form-control rounded-pill shadow-sm">
                            </div>

                            <!-- Город -->
                            <div class="mb-3">
                                <label for="city" class="form-label">Город</label>
                                <input type="text" id="city" name="city"
                                       value="{{ profile_data.get('city', '') }}"
                                       class="form-control rounded-pill shadow-sm">
                            </div>

                            <!-- Адрес -->
                            <div class="mb-3">
                                <label for="street" class="form-label">Адрес</label>
                                <input type="text" id="street" name="street"
                                       value="{{ profile_data.get('street', '') }}"
                                       class="form-control rounded-pill shadow-sm"
                                       placeholder="Улица, дом">
                            </div>

                            <!-- О себе -->
                            <div class="mb-3">
                                <label for="bio" class="form-label">О себе</label>
                                <textarea id="bio" name="bio" rows="4"
                                          class="form-control shadow-sm">{{ profile_data.get('bio', '') }}</textarea>
                            </div>

                            <!-- Кнопки -->
                            <div class="d-flex justify-content-between">
                                <a href="/profile/{{ user.id }}" class="btn btn-outline-secondary rounded-pill px-4">
                                    <i class="fas fa-arrow-left me-1"></i> Отмена
                                </a>
                                <button type="submit" class="btn btn-success rounded-pill px-4">
                                    <i class="fas fa-save me-1"></i> Сохранить
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JS для форматирования телефона -->
    <script>
        const phoneInput = document.getElementById('phone_number');

        phoneInput.addEventListener('input', function () {
            let value = this.value.replace(/\D/g, '');

            if (value.length > 0) {
                value = value.slice(0, 11);
                if (value.startsWith('7')) {
                    value = '+' + value;
                } else if (value.startsWith('8')) {
                    value = '+7' + value.slice(1);
                }

                // Форматируем под маску
                if (value.length > 2) {
                    let rest = value.slice(2);
                    value = '+7';
                    if (rest.length > 0) value += '(' + rest.slice(0, 3);
                    if (rest.length > 3) value += ')' + rest.slice(3, 6);
                    if (rest.length > 6) value += '-' + rest.slice(6, 8);
                    if (rest.length > 8) value += '-' + rest.slice(8, 10);
                }
            }

            this.value = value;
        });
    </script>
{% endblock %}